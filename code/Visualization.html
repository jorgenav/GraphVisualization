<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Twitter graph</title>

<!--Hacer un link al fichero css equivale a copiar todo el código en style-->

    <link rel="stylesheet" type="text/css" href="../data/leyenda.css">

    <!--<style>-->

        <!--.link {-->
            <!--stroke: #ccc;-->
        <!--}-->

        <!--.node circle {-->
            <!--/*fill: #ff0000;*/-->
            <!--cursor: pointer;-->
            <!--stroke: #000000;-->
            <!--stroke-width: 1.5px;-->
        <!--}-->

        <!--.node text {-->
            <!--pointer-events: none;-->
            <!--font: 10px sans-serif;-->
        <!--}-->

        <!--.d3-tip {-->
          <!--line-height: 1;-->
          <!--font-weight: bold;-->
          <!--padding: 12px;-->
          <!--background: rgba(0, 0, 0, 0.8);-->
          <!--color: #fff;-->
          <!--border-radius: 2px;-->
        <!--}-->

        <!--/* Creates a small triangle extender for the tooltip */-->
        <!--.d3-tip:after {-->
          <!--box-sizing: border-box;-->
          <!--display: inline;-->
          <!--font-size: 10px;-->
          <!--width: 100%;-->
          <!--line-height: 1;-->
          <!--color: rgba(0, 0, 0, 0.8);-->
          <!--content: "\25BC";-->
          <!--position: absolute;-->
          <!--text-align: center;-->
        <!--}-->

        <!--/* Style northward tooltips differently */-->
        <!--.d3-tip.n:after {-->
          <!--margin: -1px 0 0 0;-->
          <!--top: 100%;-->
          <!--left: 0;-->
        <!--}-->

    <!--</style>-->

</head>
<body>
<script src='http://d3js.org/d3.v3.min.js'></script>
<script>

    var width = 2120,
        height = 1280


<!--Se genera el elemento gráfico sobre el que se va a pintar con los atributos de ancho y alto definidos-->
    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);


<!--Se genera el layout a utilizar-->
    var force = d3.layout.force()
        .gravity(0.05)
        .distance(500)
        .charge(-100)
        .size([width, height]);


<!--Se carga el fichero json y se ejecuta la función en el momento en que se carga el json-->
    d3.json('../data/json-graph.json', function(error, json) {
        <!--console.log(json);-->
        <!--console.log(json.nodes[0]['id'])-->

        if (error) throw error;

//        force.linkDistance(width/4)

        force
            .nodes(json.nodes)
            .links(json.links)
            .start();

        var link = svg.selectAll(".link")
            .data(json.links)
            .enter().append("line")
            .attr("class",	"link");


<!--Si empleamos este código, node se convierte en un círculo y no en una variable tipo g-->
        <!--var node = svg.selectAll(".node")-->
            <!--.data(json.nodes)-->
            <!--.enter().append("g")-->
            <!--.attr("class", "node")-->
            <!--.call(force.drag)-->
            <!--.append("circle")-->
            <!--.attr("r", 8);-->

        <!--Con este nos permite ir añadiendo atributos a la variable tipo g-->
        var node = svg.selectAll(".node")
            .data(json.nodes)
            .enter().append("g")
            .attr("class", "node")
            .call(force.drag)

        <!--Se añade a la variable tipo g un círculo-->
        node.append("circle")
            .attr("r", 8);

        <!--Alias del usuario-->
        node.append("text")
            .attr("dx", 12)
            .attr("dy", ".35em")
            .text(function(d) { return d.alias });

        var colors	=	d3.scale.category10();

        var pattern_def =	svg.append("defs");

        <!--Clustering?-->
//        node.attr("fill", function (d) {
//            switch (d['type']) {
//                case 'artist':
//                    return colors(0);
//                case 'track':
//                    return colors(1);
//                <!--...-->
//                default:
//                    return '#ffffff';
//            }
//        });

        <!--Grado del nodo?-->
//        node.append("circle")
//            .attr("r", function (d) {
//                if (d['type'] == 'artist') {
//                    return 8 + (40 * d['popularity'] / 100);
//                } else {
//                    return 8;
//                }
//        });

        node.append("image")
            .attr('xlink:href', function(d) {return d['img']})
            .attr("x", function(d) {})
            .attr("y", function(d) {})
            .attr("width", function(d) {})
            .attr("height", function(d) {})
            .each(function(d, i) {
                if	('img' in	d) {
                // append image pattern for each node
                    pattern_def.append("pattern")
                        .attr("id", "node-img" + i)
                        .attr("patternUnits", "objectBoundingBox")
                        .attr({ "width": "100%", "height": "100%" })
                        .attr({ "viewBox": "0 0 1 1" })
                        .append("image")
                        .attr("xlink:href", d['img'])
                        .attr({
                            "x": 0,
                            "y": 0,
                            "width": "1",
                            "height": "1",
                            "preserveAspectRatio": "none"
                        })
                }
                d3.select(this).attr("fill", "url(#node-img" + i + ")")
            });




        force.on("tick", function() {
            link.attr("x1", function(d) { return d.source.x; })
                .attr("y1", function(d) { return d.source.y; })
                .attr("x2", function(d) { return d.target.x; })
                .attr("y2", function(d) { return d.target.y; });

            <!--Con transform se modifica el nodo según la función definida a continuación-->
            node.attr("transform", function(d) {
                return "translate(" + d.x + "," + d.y + ")";
            });

        });




    });


</script>
</body>
</html>